const e={dev:!0,header:"#built using mc-build (https://github.com/mc-build/mc-build)",internalScoreboard:"LANG_MC_INTERNAL",generatedDirectory:"__generated__",rootNamespace:null,defaultNamespace:null};const t=new class{constructor(){this.data=e}get dev(){return this.data.dev}set dev(e){this.data.dev=e}get header(){return this.data.header}set header(e){this.data.header=e}get internalScoreboard(){return this.data.internalScoreboard}set internalScoreboard(e){this.data.internalScoreboard=e}get generatedDirectory(){return this.data.generatedDirectory}set generatedDirectory(e){this.data.generatedDirectory=e}get rootNamespace(){return this.data.rootNamespace}set rootNamespace(e){this.data.rootNamespace=e}get defaultNamespace(){return this.data.defaultNamespace}set defaultNamespace(e){this.data.defaultNamespace=e}};var n={log:function(...e){return self.postMessage({channel:"LOG",msg:e.join(" ")})},error:function(...e){return self.postMessage({channel:"ERR",msg:e.join(" ")})},warn:function(...e){return self.postMessage({channel:"WRN",msg:e.join(" ")})},info:function(...e){return self.postMessage({channel:"INF",msg:e.join(" ")})},task:function(...e){return self.postMessage({channel:"TSK",msg:e.join(" ")})}};class s extends Error{constructor(e,t="unknown"){super(e),this.line=t}}class o extends Error{constructor(e,t="unknown"){super(e),this.line=t}}function r(e,t){let n=[],s=[];for(let e in t)s.push(e),n.push(t[e]);return s.push(`return function(){\n${e}\n}`),new Function(...s)(...n)}function a(e,t){return r(e,t)()}const c={end:[],start:[]};var i={emit(e){self.postMessage({channel:"EVT",msg:e}),c[e]&&c[e].forEach((e=>e()))},on(e,t){c[e].push(t)}};let l,u=[];class d{getPath(){return this._path}setPath(e){this._path=e}getContents(){return this._contents}setContents(e){this._contents=e}confirm(){u.push(this)}unregister(){-1!=u.indexOf(this)&&u.splice(u.indexOf(this),1)}out(){return{path:this.getPath(),contents:this.getContents()}}}let h=new Set;function f(e){if(e.indexOf("<%")>-1&&e.indexOf("%>")){const t=e.replace(/\${/g,'${"${"}').replace(/\\/g,"\\\\").replace(/<%/g,"${").replace(/%>/g,"}").replace(/\`/g,"\\`");try{return a("return `"+t+"`",l)}catch(e){throw console.log(e),new s(`invalid template literal '${t}'`)}}return e}class m{constructor(e){this.segments={}}set(e,t){this.segments[e]=this.segments[e]||[],this.segments[e].push(t)}values(){return Object.values(this.segments).flat()}valuesFor(e){return Object.values(this.segments[e]||{}).flat(1/0)}reset(e){delete this.segments[e]}}const p=new d;p.setPath("./data/minecraft/functions/"+t.generatedDirectory+"/events/tick.mcfunction");const g=new m(p),k=new d;k.setPath("./data/minecraft/functions/"+t.generatedDirectory+"/events/load.mcfunction");const b=new m(k);var x={MCFunction:class extends d{constructor(e,t,n){super(),this.parent=e,this.top=t||this,this.functions=[],this.namespace="lang_error",this._path=Math.random().toString(36).substr(2),this.target=this,this.intent=n}addCommand(e){this.functions.push(f(e))}setPath(e){this._path=e}getReference(){return this.namespace+":"+this._path}out(){return{path:this.getPath(),contents:this.getContents()}}getContents(){return(t.header?t.header+"\n\n":"")+this.functions.map((e=>e.replace(/\$block/g,this.namespace+":"+this.getFunctionPath()).replace(/\$top/g,this.top.getReference()).replace(/\$parent/g,(()=>{if(this.parent)return this.parent.getReference();throw new s("$parent used where there is no valid parent.")})))).join("\n")}getPath(){return"./data/"+this.namespace+"/functions/"+this._path+".mcfunction"}getFunctionPath(){return this._path}confirm(e){h.has(this._path)||(h.add(this._path),"load"===this.intent?b.set(e,this.getReference()):"tick"===this.intent&&g.set(e,this.getReference()),super.confirm())}toString(){return"function "+this.namespace+":"+this.getFunctionPath()}static setEnv(e){h=new Set,l=e}},tickFunction:g,loadFunction:b,loadFile:k,tickFile:p,evaluate_str:f,MultiFileTag:class{constructor(e){this.segments={},this.file=new d,this.file.setPath(e),this.current=!1}set(e,t){this.current||(this.file.confirm(),this.current=!0),this.segments[e]=this.segments[e]||[],this.segments[e].push(t),this.file.setContents(JSON.stringify({replace:!1,values:Object.values(this.segments).flat(1/0)}))}reset(e){this.current=!1,delete this.segments[e],this.current||(this.file.confirm(),this.current=!0),this.file.setContents(JSON.stringify({replace:!1,values:Object.values(this.segments).flat(1/0)}))}}};const{MCFunction:w,loadFunction:v,tickFunction:y,evaluate_str:$}=x,_={};let C=0,O=0,E=0;function S(e){return O++,E+50<Date.now()&&(postMessage({type:"progress",total:C,current:O,percent:O/C,token:e[0]}),E=Date.now()),e.shift()}let j=0,F={},N=[],P={},W={},M=null,I=null,A={},L=new Map;function B(e,t){let n=t||[];for(let t=0;t<e.length;t++)Array.isArray(e[t])?B(e[t],n):n.push(e[t]);return n}function D(e){const t=B(Array.from(L.values()));for(let n=0;n<t.length+1;n++)if(!t.includes(n)){const t=L.get(e)||[];return t.push(n),L.set(e,t),n}}const R=(e,t)=>{try{return a(`return ${e}`,{...F,args:t.args,storage:A[t.file||"mc"],type:e=>t.args[e].type})}catch(e){throw new s(e.message,t.line)}};class T{constructor(e,t){this.line=e,this.token=t}[Symbol.toStringTag](){return this.token}}const G=e=>{let t=!1;return e.split("\n").reduce(((e,n,s)=>{if((n=n.trim()).startsWith("###")&&(t=!t),t||"#"===n[0]||!n)return e;if("\\"===n[0]&&"#"==n[1]&&(n=n.slice(1)),"}"===n[0]&&(e.push(new T(s,"}")),n=n.slice(1)),"{"===n[n.length-1]){const t=n.slice(0,n.length-1).trim();t&&e.push(new T(s,t)),e.push(new T(s,"{"))}else n&&e.push(new T(s,n));return e}),[])};function q(e,t){const n=S(e);if(n&&n.token!=t)throw new s(`unexpected token '${n.token}' expected '${t}'`,n.line)}function H({getToken:e,actions:t,def:n}){const s=(e,t,...n)=>{const o=s.getToken(t),r=s.actions.find((e=>e.match(o)));return r?r.exec(e,t,...n):s.def(e,t,...n)};return s.actions=t.map(((e,t)=>(e.priority=t,e))),s.def=n,s.getToken=e,s.addAction=(e,t=s.actions.length)=>{e.priority=t,s.actions=[e,...s.actions].sort(((e,t)=>e.priority-t.priority))},s}function z(e,t){let n=new T(e.line,e.token);return n.file=e.file,n.args=t,n.dependencies=e.dependencies,n}_.Namespace=(e,t,n)=>{const o=$(t.substr("dir ".length));if(/[^a-z0-9_\.]/.test(o))throw new s("invalid directory name '"+o+"'",t.line);for(N.push(o.trim()),q(n,"{");"}"!=n[0].token;)_.Entry(e,n,!0);q(n,"}"),N.pop()},_.EntryOp=H({getToken:e=>e[0],actions:[{match:({token:e})=>/dir .+/.test(e),exec(e,t){_.Namespace(e,S(t).token,t)}},{match:({token:e})=>/function .+/.test(e),exec(e,t){_.Function(e,t)}},{match:({token:e})=>/clock .+/.test(e),exec(e,t){const{token:n}=t[0],s=n.substr(6);S(t);const o=_.Block(e,t,"clock",{prepend:["schedule function $block "+s]});v.set(e,o.substr(9))}},{match:({token:e})=>/^LOOP/.test(e),exec(e,t){const n=S(t);_.Loop(e,n.token,t,!0,_.Entry)}},{match:({token:e})=>/^!IF\(/.test(e),exec(e,t){const n=S(t),{token:s}=n,o=s.substr(4,s.length-5);if(q(t,"{"),R(o,n)){for(;"}"!=t[0].token;)_.Entry(e,t,!0);q(t,"}")}else{let e=1;for(;e&&t.length;){let n=S(t).token;"{"===n&&e++,"}"===n&&e--}}}},{match:({token:e})=>/^!.+/.test(e),exec(e,t){const n=t[0],{token:s}=n,o=s.substr(1);if(S(t),q(t,"{"),R(o,n)){for(;"}"!=t[0].token;)_.Entry(e,t,!0);q(t,"}")}else{let e=1;for(;e&&t.length;){let n=S(t).token;"{"===n&&e++,"}"===n&&e--}}}}],def:(e,t)=>{const n=S(t);throw new s(`unexpected token '${n.token}' before ${t[0]?t[0].token.length>10?t[0].token.substr(0,10)+"...":t[0].token:"EOF"}`,n.line)}}),_.Entry=(e,t,n)=>{if(n)_.EntryOp(e,t);else for(;t[0];)_.EntryOp(e,t)},_.Function=(e,t,n={})=>{const o=S(t);let r=o.token.substr(9);if(r=$(r),/[^a-z0-9_\.]/.test(r))throw new s("invalid function name '"+r+"'",o.line);const a=new w(void 0,void 0,r);for(a.namespace=N[0],a.setPath(N.slice(1).concat(r).join("/")),q(t,"{");"}"!=t[0].token&&t[0];)_.Generic(e,t,a,a,a);if(q(t,"}"),n.append)for(let e of n.append)a.addCommand(e);return a.confirm(e),a},_.Generic=H({getToken:e=>e[0],actions:[{match:({token:e})=>"load"===e,exec(e,t){S(t);const n=_.Block(e,t,"load",{dummy:!0},null,null);for(let e=0;e<n.functions.length;e++)M.addCommand(n.functions[e])}},{match:({token:e})=>"tick"===e,exec(e,t){S(t);const n=_.Block(e,t,"tick",{dummy:!0},null,null);for(let e=0;e<n.functions.length;e++)I.addCommand(n.functions[e])}},{match:({token:e})=>e.startsWith("warn "),exec(e,t){const{token:s}=S(t);n.warn($(s.substr(5).trim()))}},{match:({token:e})=>e.startsWith("error "),exec(e,t){const n=S(t),{token:s}=n;throw new o(s.substr(5).trim(),n.line)}},{match:({token:e})=>/^execute\s*\(/.test(e),exec(e,n,s,o,r){let{token:a}=S(n),c=a.substring(a.indexOf("(")+1,a.length-1);for(s.addCommand(`scoreboard players set #execute ${t.internalScoreboard} 0`),s.addCommand(`execute ${c} run ${_.Block(e,n,"conditional",{append:[`scoreboard players set #execute ${t.internalScoreboard} 1`]},o,r)}`);/^else execute\s*\(/.test(n[0].token);)a=S(n).token,c=a.substring(a.indexOf("(")+1,a.length-1),s.addCommand(`execute if score #execute ${t.internalScoreboard} matches 0 ${c} run ${_.Block(e,n,"conditional",{append:[`scoreboard players set #execute ${t.internalScoreboard} 1`]},o,r)}`);/^else/.test(n[0].token)&&(S(n),s.addCommand(`execute if score #execute ${t.internalScoreboard} matches 0 run ${_.Block(e,n,"conditional",{},o,r)}`))}},{match:({token:e})=>/^!IF\(/.test(e),exec(e,t,n){const s=S(t),{token:o}=s,r=o.substr(4,o.length-5);if(q(t,"{"),R(r,s)){for(;"}"!=t[0].token;)_.Generic(e,t,n);q(t,"}")}else{let e=1;for(;e&&t.length;){let n=S(t).token;"{"===n&&e++,"}"===n&&e--}}}},{match:({token:e})=>/^!.+/.test(e),exec(e,t,n){const s=S(t),{token:o}=s,r=o.substr(1);if(q(t,"{"),R(r,s)){for(;"}"!=t[0].token;)_.Generic(e,t,n);q(t,"}")}else{let e=1;for(;e&&t.length;){let n=S(t).token;"{"===n&&e++,"}"===n&&e--}}}},{match:({token:e})=>/^block|^{/.test(e),exec(e,t,n,s){"block"===t[0].token&&S(t),n.addCommand(_.Block(e,t,"block",{},s,null))}},{match:({token:e})=>e.startsWith("execute")&&-1!=e.indexOf("run"),exec(e,t,n,o,r){const a=S(t),{token:c}=a,i=c.substr(c.lastIndexOf("run")+3).trim(),l=c.substr(0,c.lastIndexOf("run")+3).trim();let u=!0,d=!0;if(i){"{"===i&&(d=!1),u=!1;let e=a;for(let n=0;n<t.length&&t[n].line===e.line;n++)e=t[n];const n=[];let s=1;if(e&&"{"===e.token){let e=S(t);e.line;for(n.push(e);t.length&&s||e.line==t[0].line;)"{"===t[0].token&&s++,"}"===t[0].token&&s--,e=S(t),n.push(e)}let o=z(a,a.args);t.unshift(...n,o),o.token="}",o=z(a,a.args),t.unshift(o),o.token=i,o=z(a,a.args),t.unshift(o),o.token="{"}const h=_.Block(e,t,"execute",{dummy:!0},u?o:n,u?r:n);if(h.functions.length>1)h.confirm(e),n.addCommand(l+" function "+h.getReference());else{var f;if(0==h.functions.length){const{line:e}=S(t);throw new s("Empty run block",e-1)}-1==(null===(f=h.functions[0])||void 0===f?void 0:f.indexOf("$block"))||d?n.addCommand(c):(h.confirm(e),n.addCommand(l+" function "+h.getReference()))}}},{match:({token:e})=>/^LOOP/.test(e),exec(e,t,n){const{token:s}=S(t);_.Loop(e,s,t,n,_.Generic,null,null)}},{match:({token:e})=>/until\s*\(/.test(e),exec(e,n,s,o,r){const{token:a}=S(n),c=a.substr(6,a.length-7),i=c.substr(0,c.lastIndexOf(",")).trim(),l=c.substr(c.lastIndexOf(",")+1).trim(),u=D(e),d=_.Block(e,n,"until",{prepend:[`scoreboard players set #until_${u} ${t.internalScoreboard} 1`]},o,null),h=new w,f=t.generatedDirectory+"/until/"+(j.until=(null==j.until?-1:j.until)+1);h.namespace=N[0],h.setPath(N.slice(1).concat(f).join("/")),h.addCommand(`scoreboard players set #until_${u} ${t.internalScoreboard} 0`),h.addCommand(`execute ${i} run ${d}`),h.addCommand(`execute if score #until_${u} ${t.internalScoreboard} matches 0 run schedule function $block ${l}`),h.confirm(e),s.addCommand(`function ${h.getReference()}`)}},{match:({token:e})=>/^async while/.test(e),exec(e,n,s,o){let{token:r}=S(n);const a=r.substr(12,r.length-13),c=a.substr(0,a.lastIndexOf(",")).trim(),i=a.substr(a.lastIndexOf(",")+1).trim(),l=new w,u=D(e),d=t.generatedDirectory+"/while/"+(j.while=(null==j.while?-1:j.while)+1);l.namespace=N[0],l.setPath(N.slice(1).concat(d).join("/"));const h=_.Block(e,n,"while",{append:[`scoreboard players set #WHILE_${u} ${t.internalScoreboard} 1`,`schedule function ${l.getReference()} ${i}`]},o,s);if(l.addCommand(`scoreboard players set #WHILE_${u} ${t.internalScoreboard} 0`),l.addCommand(`execute ${c} run ${h}`),/^finally$/.test(n[0].token)){r=S(n).token;const o=_.Block(e,n,"while",{},l,s);l.addCommand(`execute if score #WHILE_${u} ${t.internalScoreboard} matches 0 run ${o}`)}l.confirm(e),s.addCommand(`function ${l.getReference()}`)}},{match:({token:e})=>/^while/.test(e),exec(e,n,s,o){let{token:r}=S(n);const a=r.substr(6,r.length-7).trim(),c=new w,i=t.generatedDirectory+"/while/"+(j.while=(null==j.while?-1:j.while)+1),l=D(e);c.namespace=N[0],c.setPath(N.slice(1).concat(i).join("/"));const u=_.Block(e,n,"while",{append:[`scoreboard players set #WHILE_${l} ${t.internalScoreboard} 1`,`function ${c.getReference()}`]},o,s);if(c.addCommand(`scoreboard players set #WHILE_${l} ${t.internalScoreboard} 0`),c.addCommand(`execute ${a} run ${u}`),/^finally$/.test(n[0].token)){r=S(n).token;const o=_.Block(e,n,"while",{},c,s);c.addCommand(`execute if score #WHILE_${l} ${t.internalScoreboard} matches 0 run ${o}`)}c.confirm(e),s.addCommand(`function ${c.getReference()}`)}},{match:({token:e})=>/^schedule\s?((\d|\.)+(d|t|s)|<%.+)\s?(append|replace){0,1}$/.test(e),exec(e,t,n,s,o){const{token:r}=S(t),a=_.Block(e,t,"schedule",{},s,o),[,c,i]=$(r).split(/\s+/);n.addCommand(`schedule ${a} ${c} ${i}`.trim())}},{match:({token:e})=>"sequence"===e,exec(e,n,s){S(n);const o=_.Block(e,n,"sequence",{dummy:!0},null,null),r=e=>{let t=+e.substr(0,e.length-1);switch(e[e.length-1]){case"s":t*=20;break;case"d":t*=24e3}return t},a={};let c=0;for(let e of o.functions)if(e.startsWith("delay")){c+=r(e.substr(6).trim())}else if(e.startsWith("setdelay")){c=r(e.substr(9).trim())}else a[c]=a[c]||[],a[c].push(e);for(let e in a)if(0==e)for(const t of a[e])s.addCommand(t);else{const n=new w,o=t.generatedDirectory+"/sequence/"+(j.sequence=(null==j.sequence?-1:j.sequence)+1);n.namespace=N[0],n.setPath(N.slice(1).concat(o).join("/"));for(const t of a[e])n.addCommand(t);s.addCommand(`schedule ${n.toString()} ${e}t replace`),n.confirm()}}},{match:({token:e})=>"("===e,exec(e,t,n){S(t);let s="",o=S(t);for(;")"!=o.token;)s+=o.token+" ",o=S(t);n.addCommand(s.trim())}}],def(e,t,n,s,o){const r=S(t),{token:a}=r,[c,...i]=a.split(" ");let l=W;if(P[r.file]&&(l=P[r.file].importedMacros),!l[c]&&P[r.file]&&(l=P[r.file].macros),a.startsWith("execute")){const e=a.replace(/ run execute/g,""),s=e.indexOf(" run"),o=e.substr(s+5),[c]=o.split(" ");if(!l[c]&&"macro"!==c||r.args)n.addCommand(a);else{let n=z(r,r.args);n.token="}",t.unshift(n),n=z(r,r.args),n.token=o,t.unshift(n),n=z(r,r.args),n.token="{",t.unshift(n),n=z(r,r.args),n.token=e.substr(0,s+4),t.unshift(n)}}else n.addCommand(a)}}),_.Block=(e,n,s,o={},r,a)=>{q(n,"{"),s||(s="none");let c=null;if(n[0].token.startsWith("name ")){const e=S(n).token;c=$(e.substr(5)).trim()}else c=t.generatedDirectory+"/"+s+"/"+(j[s]=(null==j[s]?-1:j[s])+1);const i=new w(r,a);if(null===a&&(a=i),i.namespace=N[0],i.setPath(N.slice(1).concat(c).join("/")),o.prepend)for(let e of o.prepend)i.addCommand(e);for(;"}"!=n[0].token&&n[0];)_.Generic(e,n,i,i,"conditional"==s?a:i);if(o.append)for(let e of o.append)i.addCommand(e);return q(n,"}"),o.dummy?i:(i.confirm(e),i.toString())},_.Loop=(e,t,n,s,o=_.Generic,r,a)=>{let[c,i]=t.substring(t.indexOf("(")+1,t.length-1).split(",").map((e=>e.trim()));if(-1!=t.indexOf("[")){const e=t.substring(t.indexOf("(")+1,t.length-1).split(",");i=e.pop(),c=e.join(",")}if(c=R(c,t),q(n,"{"),Array.isArray(c)){for(let t=0;t<c.length-1;t++){const l=[...n];for(F[i]=c[t];"}"!=l[0].token&&l.length;)o(e,l,s,r,a)}F[i]=c[c.length-1]}else{for(let t=0;t<c-1;t++){const c=[...n];for(F[i]=t;"}"!=c[0].token&&c.length;)o(e,c,s,r,a)}F[i]=c-1}for(;"}"!=n[0].token&&n.length;)o(e,n,s,r,a);q(n,"}"),delete F[i]};const J=new x.MultiFileTag("./data/minecraft/tags/functions/tick.json"),K=new x.MultiFileTag("./data/minecraft/tags/functions/load.json");function V(e,n){let o="dummy";i.emit("start"),function(e){L.delete(e)}(o),hashes=new Map,W={},included_file_list=[],N=[n],t.defaultNamespace&&N.unshift(t.defaultNamespace),M=new w(null,null,"load"),M.namespace=N[0],M.setPath(N.slice(1).concat(t.generatedDirectory+"/load").join("/")),I=new w(null,null,"tick"),I.namespace=N[0],I.setPath(N.slice(1).concat(t.generatedDirectory+"/tick").join("/")),v.reset(o),y.reset(o),K.reset(o),J.reset(o),A={},F={config:t,file_path:o},w.setEnv(F),ifId=0,j={};try{let t=G(e);C=t.length,_.Entry(o,t),M.functions.length>0&&(M.functions=Array.from(new Set(M.functions).keys()),M.confirm(o)),I.functions.length>0&&I.confirm(o);const n=v.valuesFor(o);n.length>0&&K.set(o,n);const s=y.valuesFor(o);s.length>0&&J.set(o,s),i.emit("end")}catch(e){throw i.emit(e.message),"Cannot read property 'token' of undefined"===e.message?new s("expected more tokens","EOF"):e}}const Q={on(e,t){i.on(e,t)},io:{loadFunction:v,tickFunction:y,TickTag:J,LoadTag:K,MCFunction:w},getEnv:()=>F,getNamespace(e){const t=N.slice(1).join("/");return{namespace:N[0],path:t+(0===t.length?"":"/")}},transpiler:{tokenize:G,evaluate_str:$,consumer:_,validate_next_destructive:q,list:H,evaluators:{code:{evaluateCodeWithEnv:a,getFunctionWithEnv:r}}}},U={blocks:"blocks",entities:"entity_types",fluids:"fluids",functions:"functions",items:"items"};let X={};const Y={resolve:(...e)=>e.join("/")},Z={cwd:()=>"."},ee=(e,t)=>{try{return Q.transpiler.evaluators.code.evaluateCodeWithEnv(`return ${e}`,Q.getEnv())}catch(e){return!0}};function te(e,t){return{match:({token:t})=>t.startsWith(e),exec(e,n){const{token:s}=n.shift(),o=s.indexOf(" ")+1,r=s.substr(o,s.length),a=new d;a.setPath(Q.transpiler.evaluate_str(t(r,e))),Q.transpiler.validate_next_destructive(n,"{");let c=1,i=["{"];for(;c&&n.length;){const e=n.shift().token;i.push(Q.transpiler.evaluate_str(e)),"{"===e&&c++,"}"===e&&c--}a.setContents(i.join("")),a.confirm()}}}const ne=Q.transpiler.list({getToken:e=>e[0],actions:[{match:({token:e})=>/^LOOP/.test(e),exec(e,t,n){const{token:s}=t.shift();Q.transpiler.consumer.Loop(e,s,t,n,ne)}},{match:({token:e})=>/^!IF\(/.test(e),exec(e,t,n){const s=t.shift(),{token:o}=s,r=o.substr(4,o.length-5);if(t.shift(),Q.transpiler.validate_next_destructive(t,"{"),ee(r)){for(;"}"!=t[0].token;)ne(e,t,n);Q.transpiler.validate_next_destructive(t,"}")}else{let e=1;for(;e&&t.length;){let n=t.shift().token;"{"===n&&e++,"}"===n&&e--}}}},{match:({token:e})=>/^!.+/.test(e),exec(e,t,n){const{token:s}=t[0],o=s.substr(1);if(t.shift(),Q.transpiler.validate_next_destructive(t,"{"),ee(o)){for(;"}"!=t[0].token;)ne(e,t,n);Q.transpiler.validate_next_destructive(t,"}")}else{let e=1;for(;e&&t.length;){let n=t.shift().token;"{"===n&&e++,"}"===n&&e--}}}}],def:(e,t,n)=>{const{token:s}=t.shift();n.values.add(Q.transpiler.evaluate_str(s))}}),se=Q.transpiler,oe=se.consumer.Generic,re=se.consumer.EntryOp;oe.addAction({match:({token:e})=>e.startsWith("tags"),exec(e,t,n){const s=t.shift(),{token:o}=s,[,r,a,c]=o.split(/\s+/);if("add"!==a)throw new CompilerError(`invalid tag action '${a}'`,s.line);X.tags[r].values.add(Q.transpiler.evaluate_str(c))}}),re.addAction({match:({token:e})=>/^(blocks|entities|fluids|functions|items)/.test(e),exec(e,t){const{token:n}=t.shift(),[s,o,r]=n.split(/\s+/),a=X.tags[Q.transpiler.evaluate_str(o)]={type:U[s],replace:"replace"===r,values:new Set,namespace:Q.getNamespace()};for(Q.transpiler.validate_next_destructive(t,"{");"}"!=t[0].token;)ne(e,t,a);t.shift()}}),re.addAction(te("loot",(e=>{const t=Q.getNamespace();return Y.resolve("data",t.namespace,"loot_tables",t.path+e+".json")}))),re.addAction(te("predicate",(e=>{const t=Q.getNamespace();return Y.resolve(Z.cwd(),"data",t.namespace,"predicates",t.path+e+".json")}))),re.addAction(te("modifier",(e=>{const t=Q.getNamespace();return Y.resolve(Z.cwd(),"data",t.namespace,"item_modifiers",t.path+e+".json")}))),re.addAction(te("recipe",(e=>{const t=Q.getNamespace();return Y.resolve(Z.cwd(),"data",t.namespace,"recipes",t.path+e+".json")}))),re.addAction(te("advancement",(e=>{const t=Q.getNamespace();return Y.resolve(Z.cwd(),"data",t.namespace,"advancements",t.path+e+".json")}))),Q.on("start",(e=>{X={tags:{}}})),Q.on("end",(e=>{for(const e in X.tags){const t=X.tags[e],n=new d;n.setPath(Y.resolve(Z.cwd(),"data",t.namespace.namespace,"tags",t.type,t.namespace.path+e+".json")),n.setContents(JSON.stringify({replace:t.replace,values:Array.from(t.values)})),n.confirm()}})),self.onmessage=e=>{V(e.data.contents,e.data.namespace),self.postMessage(u.map((e=>e.out())))};